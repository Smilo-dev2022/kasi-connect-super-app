<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Moderation Admin</title>
	<link rel="stylesheet" href="/static/style.css" />
</head>
<body>
	<header>
		<h1>Moderation Admin â€“ Day 1 Stub</h1>
	</header>
	<main>
		<section>
			<h2>Reports</h2>
			<div id="reports"></div>
		</section>
	</main>
	<script>
	async function loadReports() {
		const res = await fetch('/api/reports');
		const reports = await res.json();
		const container = document.getElementById('reports');
		if (!Array.isArray(reports) || reports.length === 0) {
			container.innerHTML = '<p>No reports yet.</p>';
			return;
		}
		container.innerHTML = '';
		reports.forEach(r => {
			const el = document.createElement('div');
			el.className = 'report';
			el.innerHTML = `
				<div class="row">
					<div><strong>ID</strong>: ${r.id}</div>
					<div><strong>Status</strong>: ${r.status}</div>
					<div><strong>Reason</strong>: ${r.reason}</div>
					<div><strong>Escalation</strong>: L${r.escalation_level} ${r.sla_minutes ? `(SLA ${r.sla_minutes}m)` : ''}</div>
				</div>
				<div class="content"><strong>Content</strong>: ${r.content_text}</div>
				<div class="actions">
					<button onclick="escalate('${r.id}', 1)">Escalate</button>
					<button onclick="deescalate('${r.id}')">De-escalate</button>
					<button onclick="closeReport('${r.id}')">Close</button>
				</div>
			`;
			container.appendChild(el);
		});
	}

	async function escalate(id, levelDelta) {
		await fetch(`/api/reports/${id}/escalate?level_delta=${levelDelta}`, { method: 'POST' });
		loadReports();
	}

	async function deescalate(id) {
		await fetch(`/api/reports/${id}/deescalate`, { method: 'POST' });
		loadReports();
	}

	async function closeReport(id) {
		await fetch(`/api/reports/${id}/close`, { method: 'POST' });
		loadReports();
	}
	loadReports();
	</script>
</body>
</html>